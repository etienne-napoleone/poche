language: python
python:
  - "3.6"
  - "3.7"
  - "3.8"

before_install:
  - pip install poetry
  - pip install dataclasses
install:
  - poetry install

script:
  - flake8 .
  - mypy --ignore-missing-imports --follow-imports=silent --show-column-numbers .
  - coverage run --source poche -m pytest -v
  - coverage report
  - codecov

before_deploy:
  - poetry build
deploy:
  - provider: releases
    token: $GITHUB_TOKEN
    file_glob: true
    file: dist/*
    on:
      tags: true
      python: 3.6
  - provider: pypi
    username: $PYPI_USERNAME
    password: $PYPI_PASSWORD
    on:
      tags: true
      python: 3.6
